{"version":3,"file":"interaction-areas.js","mappings":"4LAGO,MAAMA,EAAeC,IAAqD,IAApD,KAAEC,EAAI,QAAEC,EAAO,MAAEC,EAAQ,GAAE,aAAEC,EAAe,GAAGJ,EAC1E,OAAOK,EAAAA,EAAAA,IAAgB,CACrBC,IAAK,SACLC,KAAM,CAAEC,MAAQ,yBAAwBL,KACxCD,UACAO,SAAU,CACR,CACEH,IAAK,MACLC,KAAM,CAAEC,MAAO,kBACfE,MAAO,CACL,qBAAuB,GAAEN,QAG7B,CACEE,IAAK,MACLC,KAAM,CAAEC,MAAO,WACfC,SAAUR,KAGd,ECLEU,EAA2BA,CAACC,EAAMC,IAAUD,EAAKE,IAAMF,EAAKG,MAAS,MAAKF,IAEnEG,EAAyBA,CAAAhB,EAAoCY,EAAMC,EAAOI,EAAcf,KAAY,IAA1E,cAAEgB,EAAa,eAAEC,GAAgBnB,EACtE,MAAMoB,GAAeC,EAAAA,EAAAA,GAAsBF,GACrCG,EAAcJ,GAAiBA,EAAcK,OAASL,EAAcK,OAAOC,OAASJ,EAAaI,OAGjGrB,GAAQsB,EAAAA,EAAAA,IAAIN,EAAgB,oCAAqCO,EAAAA,GAAwBC,SAE/F,OAAOtB,EAAAA,EAAAA,IAAgB,CACrBC,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,iBAAuCzB,IAAS,UAAWQ,EAAyBC,EAAMC,IAC5GH,MAAO,CACLmB,KAAO,GAAEjB,EAAKiB,QACdC,IAAM,GAAElB,EAAKkB,OACbC,MAAQ,GAAEnB,EAAKmB,SACfC,OAAS,GAAEpB,EAAKoB,UAChBC,mBAAqB,GAAEhB,OAEzBiB,MAAO,CACLC,KAAM,QACNC,SAAUlC,GAEZO,SAAU,CACR,CACEH,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,kBAClBnB,SAAU,CACR,CACEH,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,oBAClBlB,MAAO,CAAE,CAACP,IAAUuB,EAAAA,GAAwBW,SAAW,kBAAoB,eAAgBf,IAE7F,CACEhB,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,kBAClBlB,MAAO,CAAE4B,YAAahB,QAK9B,EAISiB,EAAyBA,CAACC,EAAOC,IAAWD,GAAS,KAAOC,GA8B5DC,EAA+BA,CAACC,EAASC,KACpD,MAAMC,EAAmCC,EAA6BH,GAElEE,EACFA,EAAiCE,YAAYH,GAG7CD,EAAQK,KAAKC,YAAYL,EAC3B,EAGIM,EAAgCA,CAACC,EAA2BvC,EAAMC,IAAUsC,EAA0BC,cAAe,YAAWzC,EAAyBC,EAAMC,OAkD/JwC,EAAoC,SAACC,GAA4B,IAAnBpD,EAAOqD,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAGG,EAAAA,GAC5DC,aAAaC,QAAQC,EAAAA,GAA4CC,KAAKC,MAAMT,IAC5EpD,GACF,EAuDM4C,EAAgCH,GAAYA,EAAQK,KAAKI,cAAe,IAAGY,EAAAA,MAEpEC,EAAmCtB,IAC9C,MAAMQ,EAA4BL,EAA6BH,GAG/DQ,GAA6BA,EAA0Be,WAAWC,YAAYhB,EAA0B,E,kCChMnG,MAAMiB,EAA0BA,CAACC,EAAQnD,EAAeC,KAE7D,IAAImD,GAAW,EACXC,EAAgB,KAChBC,EAAe,KACfC,EAASf,EAAAA,GAEb,MAEMgB,EAAsBA,KAC1B,MAAMC,EAAyBC,IAC/B,SAAQD,QAAoElB,IAA1CkB,EAAuBE,iBAAgCF,EAAuBE,cAAsB,EAGxI,SAASC,IAA2C,IAAjBC,EAAOxB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACxC,MAAMoB,EAAyBC,IAC/B,OAAOG,GAAYJ,GAA0BA,EAAuBK,MACtE,CAEA,SAASC,IACPT,GAAgBH,EAAO1B,QAAQuC,sBAAsBV,GAErD,MAAMW,EAAYL,IACZH,EAAyBC,IAE/B,IAAKO,GAAab,EAChB,OAAO,KAGT,GAAIc,MAAMC,QAAQV,EAAuBW,UACvCC,EAAyBZ,EAAuBW,UAChDE,QACK,CACL,MAAMC,EAASd,EAAuBc,QAAUC,EAAAA,GAA+Bf,EAAuBW,UAElGG,IACFjB,GAAemB,EAAAA,EAAAA,IAAiBtB,EAAO1B,QAAS8C,GA6JtD,SAAwBG,GACtB,IAAKA,EACH,OAGF,IAAIC,EAAqB,KAEzBD,EAAME,iBAAiB,aAAa,KAClC,MAAMC,EAAYH,EAAMI,YAAcJ,EAAMI,WAAW,GAEvD,GAAID,EAAW,CACb,MAAM9E,EAAegF,KAAKC,IAAID,KAAKE,MAAkD,KAA3CJ,EAAUK,QAAUL,EAAUM,YAAoBC,EAAAA,IAEtFC,EAAazC,KAAKC,MAAMgC,EAAU9F,MAExCsF,EAAyBgB,EAAYV,EAAoB5E,IACxD4E,GAAsBL,IACvBK,EAAqBU,CACvB,MACEtC,EAAgCI,EAAO1B,SACvCkD,EAAqB,IACvB,GAEJ,CAnLMW,CAAehC,GAEnB,CACF,CAaA,SAASI,IACP,MAAM,OAAE6B,GAAWlC,EACnB,OAAOkC,GAAUA,EAAOC,qBAC1B,CAEA,SAASC,IACP1C,EAAgCI,EAAO1B,SACvCsC,IACAZ,EAAOuC,MACT,CAEA,SAASC,IACP,GAAK/B,IAIL,GDoDwCH,EClHoBxD,EAAe2F,oBDmHrDrF,EAAAA,EAAAA,IAAIkD,EAAwB,iBAAiB,IAE0B,SAArEhB,aAAaoD,QAAQlD,EAAAA,ICvDlB,CACzB,IAAImD,EAAsB,KAC1B,MAAMC,GAAsBxF,EAAAA,EAAAA,IAAIN,EAAgB,uCAAuC,GACvFkD,EAAO6C,QD6DqC,SAACvE,EAASzC,GAAyC,IAAhC+G,EAAmB1D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAElFD,GAAU,EAEd,MAAMxC,EAAM,YAAWmF,KAAKkB,MAAsB,IAAhBlB,KAAKmB,YAEjCC,GAAkBhH,EAAAA,EAAAA,IAAgB,CACtCC,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEwD,EAAAA,MAA0CpC,EAAAA,qBAA2CqF,EAAsB,GAAK,eAClI/G,QAAU+G,EAAkF,KAA5D,IAAM5D,EAAkCC,EAASpD,GACjFO,SAAU,CACR,CACEH,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,iBAAwC0F,IAAKC,EAAAA,KAEjE,CACEjH,IAAK,KACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,2BAClBnB,SAAU,sCAEZV,EAAa,CACXE,KAAM,SACNE,MEnLa,oBFoLbC,aAAc6G,EAAsB,EAAIO,EAAAA,GACxCtH,QAAS+G,EAAsB,IAAM5D,EAAkCC,EAASpD,GAAW,OAE7F+G,GAAuB,CACrB3G,IAAK,MACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,iCAClBnB,SAAU,CACR,CACEH,IAAK,QACLC,KAAM,CAAEQ,KAAM,WAAYP,MAAQ,GAAEoB,EAAAA,6BAAoDd,MACxFoB,MAAO,CACLC,KAAM,QACNC,SAAWF,IACToB,EAAUpB,EAAMuF,OAAOnE,OAAO,IAIpC,CACEhD,IAAK,QACLC,KAAM,CAAEC,MAAQ,GAAEoB,EAAAA,mCAA0D8F,IAAK5G,GACjFL,SAAU,0BAIhBkH,QAAOC,GAAKA,MAGhBlF,EAA6BC,EAAS0E,EACxC,CC9GMQ,CAAmCxD,EAAO1B,SAAS,KACjDmF,aAAad,GACbL,GAAqB,GACpBM,GAEEA,IACHD,EAAsBe,WAAWpB,EAAqBa,EAAAA,IAE1D,MACEb,IA5EwBqB,IDkHcrD,CCpC1C,CAyEA,SAASsD,EAAuBjI,GAAyB,IAAxB,MAAEkC,EAAK,KAAEtB,EAAI,MAAEC,GAAOb,EACrD,MAAM2E,EAAyBC,IAE/BD,EAAuBzE,SAAWyE,EAAuBzE,QAAQ,CAC/DU,OACAC,QACAqB,QACAgG,KAAMA,CAACC,EAAQC,MApCnB,SAAgBd,EAAKe,EAAWzH,GAC9B,MAAM0H,EAAsBjE,EAAOkE,cAC7BC,EAAmB9D,KACnB,OAAE+B,GAAWlC,EACbkE,EAAoBhC,EAAOiC,iBAC3BN,EAASC,GAAa,CAAEM,eAAgBF,EAAkBE,gBAC1DA,GAAkBrB,GDhGSsB,EAACC,EAAcC,KAElD,MAAM,YAAEC,EAAW,WAAEC,GAAeH,EAE9BI,EAAQ1G,EAAuByG,EAAYF,EAAoBjH,MAC/DqH,EAAQ3G,EAAuBwG,EAAaD,EAAoBhH,KAChEqH,EAAY5G,EAAuByG,EAAYF,EAAoB/G,OACnEqH,EAAa7G,EAAuBwG,EAAaD,EAAoB9G,QAErEqH,EAAmBL,EAAaD,EAChCO,EAAkBH,EAAYC,EAE9BrH,EAAQkE,KAAKkB,MAAMmC,EAAkB,GAAKD,EAAmB,EAAID,EAAaE,EAAkBH,GAChGnH,EAASiE,KAAKkB,MAAMpF,EAAQsH,GAE5BE,EAAItD,KAAKkB,MAAM8B,GAASlH,EAAQoH,GAAa,GAC7CK,EAAIvD,KAAKkB,MAAM+B,GAASlH,EAASoH,GAAc,GAErD,MAAO,CACLrH,QACAC,SACAuH,EAAGtD,KAAKwD,IAAIxD,KAAKC,IAAIqD,EAAG,GAAIP,EAAajH,GACzCyH,EAAGvD,KAAKwD,IAAIxD,KAAKC,IAAIsD,EAAG,GAAIT,EAAc/G,GAC1C0H,KAAM,OACP,ECwEgCd,CAAsBvE,EAAOwE,aAAcjI,GACpE+I,EAAgBhB,EAAiBhG,IAAAA,IAAYiH,MAAM,CAAEjB,kBAAkBP,GAAUA,EAEjFyB,EAAYpD,EAAOqD,SAAWvF,EAAc+C,IAAM,CAAEyC,SAAUtD,EAAOsD,YAC3E1F,EAAO8D,OAAOQ,EAAiB,CAAEoB,SAAUtD,EAAOsD,YAAezC,EAAKqC,GAAe/C,OACrF4B,GAAoBnE,EAAOkE,YAAYD,GAEvChE,GAAW,EApGb,WACE,MAAM0F,GAASC,EAAAA,EAAAA,IAAc,MAAO,CAAE,MAAS,mBAE/CD,EAAOlE,iBAAiB,SAAS,KAC/BrB,GAAQ,IACP,GAEH,MAAM4C,GAAkB4C,EAAAA,EAAAA,IAAc,MAAO,CAAE,MAASjG,EAAAA,IAA0CgG,GAClGtH,EAA6B2B,EAAO1B,QAAS0E,EAC/C,CA6FE6C,GAEAzF,EAASA,KACP,GAAIH,EAAU,CACZA,GAAW,EACX,MAAM6F,EAAoB9F,EAAOkE,cAC3B6B,EAAW/F,EAAO+F,WACxB/F,EAAO8D,OAAO0B,EAAWpB,GAAmB7B,OAC5C4B,GAAoB2B,EAAoBC,GAAY/F,EAAOkE,YAAY4B,GACvElF,GACF,EAEJ,CAUMoF,CAAOlC,EAAQC,EAAQxH,EAAK,GAGlC,CAEA,SAAS2E,EAAyB+E,EAAsBC,GAAgD,IAAlBtJ,EAAYsC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EACnG,MAAMiH,EAAU,CAAEtJ,cAAeA,EAAeC,eAAgBA,GAEhE,GAAIoJ,ED7FkCE,EAAC9H,EAAS6H,EAASF,EAAsBC,EAA8BtJ,EAAcf,KAC7H,MAAMiD,EAA4BL,EAA6BH,IAE/D+H,EAAAA,EAAAA,IAAQJ,GAAsB,CAAC1J,EAAMC,KACnC,MAAM8J,EAAczH,EAA8BC,EAA2BvC,EAAMC,GAC7E+J,EAASjK,EAAyBC,GAClCiK,GAAcC,EAAAA,EAAAA,GAAKP,GAA8B3C,GAAKjH,EAAyBiH,KAAOgD,IAGxFC,GAAeF,GACjBI,EAAAA,EAAAA,IAAaJ,EAAa,CACxB9I,KAAO,GAAEjB,EAAKiB,QACdC,IAAM,GAAElB,EAAKkB,OACbC,MAAQ,GAAEnB,EAAKmB,SACfC,OAAS,GAAEpB,EAAKoB,UAChBC,mBAAqB,GAAEhB,QAGf4J,GAAgBF,GAE1BxH,EAA0BF,YAAYjC,EAAuBwJ,EAAS5J,EAAMC,EAAOI,GAAeiB,IAChGhC,EAAQ,CAAEgC,QAAOtB,OAAMC,SAAQ,IAEnC,KAIF6J,EAAAA,EAAAA,IAAQH,GAA8B,CAAC3J,EAAMC,KAC3C,MAAM8J,EAAczH,EAA8BC,EAA2BvC,EAAMC,GAC7E+J,EAASjK,EAAyBC,GAClCoK,IAAmBF,EAAAA,EAAAA,GAAKR,GAAsB1C,GAAKjH,EAAyBiH,KAAOgD,IAErFD,GAAeK,GAEjBL,EAAYzG,WAAWC,YAAYwG,EACrC,GACA,EC0DEF,CAA2BpG,EAAO1B,QAAS6H,EAASF,EAAsBC,EAA8BtJ,EAAcgH,OACjH,CACL,MAAMgD,EAAwBX,EAAqBY,KAAI,CAACtK,EAAMC,IACrDG,EAAuBwJ,EAAS5J,EAAMC,EAAOI,GAAeiB,IACjE+F,EAAwB,CAAE/F,QAAOtB,OAAMC,SAAQ,MAInD6B,EAA6B2B,EAAO1B,SAASsH,EAAAA,EAAAA,IAAc,MAAO,CAAE,MAASjG,EAAAA,IAA0CiH,GACzH,CACF,CAEA,SAASzF,IACHV,KDOwCqG,EAACxI,EAASkG,KAExD,MAAM1F,EAA4BL,EAA6BH,GAE/D,IAAKQ,EACH,OAGF,MAAM,YAAE4F,EAAW,WAAEC,GAAeH,EAC9BQ,EAAmBL,EAAaD,EAEhChH,EAAQsH,EAAmBR,EAAauC,aAE9CjI,EAA0BzC,MAAMqB,MAAS,GAAE8G,EAAawC,YAActJ,EAAQ,OAASA,MACvFoB,EAA0BzC,MAAMsB,OAAS6G,EAAawC,YAActJ,EAAW8G,EAAawC,YAAchC,EAA7B,KAAoD,MAAM,ECpBnI8B,CAAiC9G,EAAO1B,QAAS0B,EAAOwE,aAE5D,EAlGA,WAGE,GAFAtE,EAAgBA,GAAiBF,EAAO1B,QAAQ4B,gBAE5CO,IAA6B,CAE/BT,EAAO1B,QAAQK,KAAKsI,UAAUC,IAAI,qBAElClH,EAAO1B,QAAQ6I,IAAIC,EAAAA,EAAaC,MAAM,KACF,iBAAvBrH,EAAO1B,QAAQgJ,IAb9BtH,EAAOuH,GAAG,YAAY,KACpBvH,EAAO1B,QAAQgJ,IAAI7F,iBAAiB+F,OAAOC,OAAOH,IAAII,QAAQC,KAAKC,kBAAmBpF,EAAiB,IAenGA,GACF,IAGF,MAAMsE,GAAmCe,EAAAA,EAAAA,GAAS1G,EAAkB,KAEpEnB,EAAO1B,QAAQiJ,GAAGH,EAAAA,EAAaU,oBAAoB,KAEjDpE,WAAWoD,EAAkC,IAAI,IAGnD,MAAMiB,GAAgBtG,EAAAA,EAAAA,IAAiB+F,OAAQ,SAAUrG,GAAkB,GAE3EnB,EAAO1B,QAAQiJ,GAAGH,EAAAA,EAAaY,QAASD,EAC1C,CAEA/H,EAAO1B,QAAQiJ,GAAGH,EAAAA,EAAaa,OAAO,KACpC7H,GAAQ,IAGVJ,EAAO1B,QAAQiJ,GAAGH,EAAAA,EAAac,OAAO,KACpClI,EAAO6C,OAAO,GAElB,CA2FAsF,EAAM,C,iBErOR,SAASN,EAASO,EAAIC,GACpB,IAAIC,EAAOd,OAAOe,YAAYC,MAW9B,OATkB,WAChB,MAAMA,EAAMhB,OAAOe,YAAYC,MAE3BA,EAAMF,GAAQD,IAChBD,KAAGlJ,WACHoJ,EAAOE,EAEX,CAGF,C","sources":["webpack:///./components/themeButton/themedButton.js","webpack:///./plugins/interaction-areas/interaction-areas.utils.js","webpack:///./plugins/interaction-areas/interaction-areas.service.js","webpack:///./components/themeButton/themedButton.const.js","webpack:///./utils/throttle.js"],"sourcesContent":["import { elementsCreator } from '../../utils/dom';\n\n\nexport const themedButton = ({ text, onClick, theme = '', loadingDelay = 0 }) => {\n  return elementsCreator({\n    tag: 'button',\n    attr: { class: `vp-theme-button theme-${theme}` },\n    onClick,\n    children: [\n      {\n        tag: 'div',\n        attr: { class: 'vp-loading-bar' },\n        style: {\n          'animation-duration': `${loadingDelay}ms`\n        }\n      },\n      {\n        tag: 'div',\n        attr: { class: 'content' },\n        children: text\n      }\n    ]\n  });\n};\n\n","import { elementsCreator, styleElement } from '../../utils/dom';\nimport { get } from '../../utils/object';\nimport {\n  CLOSE_INTERACTION_AREA_LAYOUT_DELAY,\n  INTERACTION_AREA_HAND_ICON,\n  INTERACTION_AREA_LAYOUT_LOCAL_STORAGE_NAME,\n  INTERACTION_AREAS_CONTAINER_CLASS_NAME,\n  INTERACTION_AREAS_PREFIX,\n  INTERACTION_AREAS_THEME\n} from './interaction-areas.const';\nimport { noop } from '../../utils/type-inference';\nimport { getDefaultPlayerColor } from '../colors';\nimport { forEach, some } from '../../utils/array';\nimport { themedButton } from '../../components/themeButton/themedButton';\nimport { BUTTON_THEME } from '../../components/themeButton/themedButton.const';\n\n\nconst getInteractionAreaItemId = (item, index) => item.id || item.type || `id_${index}`;\n\nexport const getInteractionAreaItem = ({ playerOptions, videojsOptions }, item, index, durationTime, onClick) => {\n  const defaultColor = getDefaultPlayerColor(videojsOptions);\n  const accentColor = playerOptions && playerOptions.colors ? playerOptions.colors.accent : defaultColor.accent;\n\n  // theme = 'pulsing' / 'shadowed'\n  const theme = get(videojsOptions, 'interactionDisplay.theme.template', INTERACTION_AREAS_THEME.PULSING);\n\n  return elementsCreator({\n    tag: 'div',\n    attr: { class: `${INTERACTION_AREAS_PREFIX}-item theme-${theme}`, 'data-id': getInteractionAreaItemId(item, index) },\n    style: {\n      left: `${item.left}%`,\n      top: `${item.top}%`,\n      width: `${item.width}%`,\n      height: `${item.height}%`,\n      transitionDuration: `${durationTime}ms`\n    },\n    event: {\n      name: 'click',\n      callback: onClick\n    },\n    children: [\n      {\n        tag: 'div',\n        attr: { class: `${INTERACTION_AREAS_PREFIX}-area-marker` },\n        children: [\n          {\n            tag: 'div',\n            attr: { class: `${INTERACTION_AREAS_PREFIX}-marker-shadow` },\n            style: { [theme === INTERACTION_AREAS_THEME.SHADOWED ? 'backgroundColor' : 'borderColor']: accentColor }\n          },\n          {\n            tag: 'div',\n            attr: { class: `${INTERACTION_AREAS_PREFIX}-marker-main` },\n            style: { borderColor: accentColor }\n          }\n        ]\n      }\n    ]\n  });\n};\n\n\nexport const percentageToFixedValue = (outOf, value) => (outOf / (100 / +value));\n\nexport const getZoomTransformation = (videoElement, interactionAreaItem) => {\n\n  const { videoHeight, videoWidth } = videoElement;\n\n  const itemX = percentageToFixedValue(videoWidth, interactionAreaItem.left);\n  const itemY = percentageToFixedValue(videoHeight, interactionAreaItem.top);\n  const itemWidth = percentageToFixedValue(videoWidth, interactionAreaItem.width);\n  const itemHeight = percentageToFixedValue(videoHeight, interactionAreaItem.height);\n\n  const videoAspectRatio = videoWidth / videoHeight;\n  const itemAspectRatio = itemWidth / itemHeight;\n\n  const width = Math.round(itemAspectRatio > 1 || videoAspectRatio > 1 ? itemHeight * itemAspectRatio : itemWidth);\n  const height = Math.round(width / videoAspectRatio);\n\n  const x = Math.round(itemX - (width - itemWidth) / 2);\n  const y = Math.round(itemY - (height - itemHeight) / 2);\n\n  return {\n    width,\n    height,\n    x: Math.min(Math.max(x, 0), videoWidth - width),\n    y: Math.min(Math.max(y, 0), videoHeight - height),\n    crop: 'crop'\n  };\n};\n\n\nexport const setInteractionAreasContainer = (videojs, newInteractionAreasContainer) => {\n  const currentInteractionAreasContainer = getInteractionAreasContainer(videojs);\n\n  if (currentInteractionAreasContainer) {\n    currentInteractionAreasContainer.replaceWith(newInteractionAreasContainer);\n  } else {\n    // do not use element.append for ie11 support\n    videojs.el().appendChild(newInteractionAreasContainer);\n  }\n};\n\nconst getInteractionAreaElementById = (interactionAreasContainer, item, index) => interactionAreasContainer.querySelector(`[data-id=${getInteractionAreaItemId(item, index)}]`);\n\n\nexport const updateInteractionAreasItem = (videojs, configs, interactionAreasData, previousInteractionAreasData, durationTime, onClick) => {\n  const interactionAreasContainer = getInteractionAreasContainer(videojs);\n\n  forEach(interactionAreasData, (item, index) => {\n    const itemElement = getInteractionAreaElementById(interactionAreasContainer, item, index);\n    const itemId = getInteractionAreaItemId(item);\n    const isExistItem = some(previousInteractionAreasData, i => getInteractionAreaItemId(i) === itemId);\n\n    // in case the element of the item is in the dom and exist in the previous data , it update the element position\n    if (isExistItem && itemElement) {\n      styleElement(itemElement, {\n        left: `${item.left}%`,\n        top: `${item.top}%`,\n        width: `${item.width}%`,\n        height: `${item.height}%`,\n        transitionDuration: `${durationTime}ms`\n      });\n      // if the element did not exist before , not in the dom and not in the previous data , it add a new element\n    } else if (!isExistItem && !itemElement) {\n      // do not use element.append for ie11 support\n      interactionAreasContainer.appendChild(getInteractionAreaItem(configs, item, index, durationTime, (event) => {\n        onClick({ event, item, index });\n      }));\n    }\n  });\n\n  // checking the previous data for element that should be removed if not exist in the new data object.\n  forEach(previousInteractionAreasData, (item, index) => {\n    const itemElement = getInteractionAreaElementById(interactionAreasContainer, item, index);\n    const itemId = getInteractionAreaItemId(item);\n    const shouldBeRemoved = !some(interactionAreasData, i => getInteractionAreaItemId(i) === itemId);\n\n    if (itemElement && shouldBeRemoved) {\n      // do not use element.remove for ie11 support\n      itemElement.parentNode.removeChild(itemElement);\n    }\n  });\n\n};\n\nexport const shouldShowAreaLayoutMessage = (interactionAreasConfig) => {\n  const isLayoutEnabled = get(interactionAreasConfig, 'layout.enable', true);\n\n  return isLayoutEnabled && localStorage.getItem(INTERACTION_AREA_LAYOUT_LOCAL_STORAGE_NAME) !== 'true';\n};\n\n\nconst onClickInteractionAreaLayoutClick = (checked, onClick = noop) => {\n  localStorage.setItem(INTERACTION_AREA_LAYOUT_LOCAL_STORAGE_NAME, JSON.parse(checked));\n  onClick();\n};\n\nexport const createInteractionAreaLayoutMessage = (videojs, onClick, showItAgainCheckbox = false) => {\n\n  let checked = false;\n\n  const id = `checkbox_${Math.round(Math.random() * 10000)}`;\n\n  const tracksContainer = elementsCreator({\n    tag: 'div',\n    attr: { class: `${INTERACTION_AREAS_CONTAINER_CLASS_NAME} ${INTERACTION_AREAS_PREFIX}-layout-message ${showItAgainCheckbox ? '' : 'clickable'}` },\n    onClick: !showItAgainCheckbox ? () => onClickInteractionAreaLayoutClick(checked, onClick) : null,\n    children: [\n      {\n        tag: 'img',\n        attr: { class: `${INTERACTION_AREAS_PREFIX}-layout-icon`, src: INTERACTION_AREA_HAND_ICON }\n      },\n      {\n        tag: 'h3',\n        attr: { class: `${INTERACTION_AREAS_PREFIX}-layout-message-title` },\n        children: 'Tap on dots to zoom for a product.'\n      },\n      themedButton({\n        text: 'Got it',\n        theme: BUTTON_THEME.TRANSPARENT_WHITE,\n        loadingDelay: showItAgainCheckbox ? 0 : CLOSE_INTERACTION_AREA_LAYOUT_DELAY,\n        onClick: showItAgainCheckbox ? () => onClickInteractionAreaLayoutClick(checked, onClick) : null\n      }),\n      showItAgainCheckbox && {\n        tag: 'div',\n        attr: { class: `${INTERACTION_AREAS_PREFIX}-layout-message-do-not-show` },\n        children: [\n          {\n            tag: 'input',\n            attr: { type: 'checkbox', class: `${INTERACTION_AREAS_PREFIX}-layout-message-checkbox`, id },\n            event: {\n              name: 'input',\n              callback: (event) => {\n                checked = event.target.checked;\n              }\n            }\n          },\n          {\n            tag: 'label',\n            attr: { class: `${INTERACTION_AREAS_PREFIX}-layout-message-checkbox-title`, for: id },\n            children: 'Don׳t show it again'\n          }\n        ]\n      }\n    ].filter(i => i)\n  });\n\n  setInteractionAreasContainer(videojs, tracksContainer);\n};\n\nconst getInteractionAreasContainer = (videojs) => videojs.el().querySelector(`.${INTERACTION_AREAS_CONTAINER_CLASS_NAME}`);\n\nexport const removeInteractionAreasContainer = (videojs) => {\n  const interactionAreasContainer = getInteractionAreasContainer(videojs);\n\n  // do not use element.remove for ie11 support\n  interactionAreasContainer && interactionAreasContainer.parentNode.removeChild(interactionAreasContainer);\n};\n\nexport const setInteractionAreasContainerSize = (videojs, videoElement) => {\n\n  const interactionAreasContainer = getInteractionAreasContainer(videojs);\n\n  if (!interactionAreasContainer) {\n    return;\n  }\n\n  const { videoHeight, videoWidth } = videoElement;\n  const videoAspectRatio = videoWidth / videoHeight;\n\n  const width = videoAspectRatio * videoElement.clientHeight;\n\n  interactionAreasContainer.style.width = `${videoElement.clientWidth < width ? '100%' : width}px`;\n  interactionAreasContainer.style.height = videoElement.clientWidth < width ? `${videoElement.clientWidth / videoAspectRatio}px` : '100%';\n};\n","import videojs from 'video.js';\nimport {\n  CLOSE_INTERACTION_AREA_LAYOUT_DELAY,\n  DEFAULT_INTERACTION_ARE_TRANSITION,\n  INTERACTION_AREAS_CONTAINER_CLASS_NAME, TEMPLATE_INTERACTION_AREAS_VTT\n} from './interaction-areas.const';\nimport {\n  createInteractionAreaLayoutMessage,\n  getInteractionAreaItem,\n  getZoomTransformation,\n  removeInteractionAreasContainer,\n  setInteractionAreasContainer,\n  setInteractionAreasContainerSize,\n  shouldShowAreaLayoutMessage,\n  updateInteractionAreasItem\n} from './interaction-areas.utils';\nimport { addEventListener, createElement } from '../../utils/dom';\nimport { throttle } from '../../utils/throttle';\nimport { get } from '../../utils/object';\nimport { noop } from '../../utils/type-inference';\nimport { addMetadataTrack } from '../../video-player.utils';\nimport { PLAYER_EVENT } from '../../utils/consts';\n\nimport './interaction-areas.scss';\n\nexport const interactionAreasService = (player, playerOptions, videojsOptions) => {\n\n  let isZoomed = false;\n  let currentSource = null;\n  let currentTrack = null;\n  let unZoom = noop;\n\n  const shouldLayoutMessage = () => shouldShowAreaLayoutMessage(videojsOptions.interactionDisplay);\n\n  const getIsSyncOffsetTime = () => {\n    const interactionAreasConfig = getInteractionAreasConfig();\n    return (interactionAreasConfig && interactionAreasConfig.syncOffsetTime !== undefined) ? interactionAreasConfig.syncOffsetTime : false;\n  };\n\n  function isInteractionAreasEnabled(enabled = false) {\n    const interactionAreasConfig = getInteractionAreasConfig();\n    return enabled || (interactionAreasConfig && interactionAreasConfig.enable);\n  }\n\n  function setAreasPositionListener() {\n    currentTrack && player.videojs.removeRemoteTextTrack(currentTrack);\n\n    const isEnabled = isInteractionAreasEnabled();\n    const interactionAreasConfig = getInteractionAreasConfig();\n\n    if (!isEnabled || isZoomed) {\n      return null;\n    }\n\n    if (Array.isArray(interactionAreasConfig.template)) {\n      addInteractionAreasItems(interactionAreasConfig.template);\n      setContainerSize();\n    } else {\n      const vttUrl = interactionAreasConfig.vttUrl || TEMPLATE_INTERACTION_AREAS_VTT[interactionAreasConfig.template];\n\n      if (vttUrl) {\n        currentTrack = addMetadataTrack(player.videojs, vttUrl);\n        addCueListener(currentTrack);\n      }\n    }\n  }\n\n  function setGoBackButton() {\n    const button = createElement('div', { 'class': 'go-back-button' });\n\n    button.addEventListener('click', () => {\n      unZoom();\n    }, false);\n\n    const tracksContainer = createElement('div', { 'class': INTERACTION_AREAS_CONTAINER_CLASS_NAME }, button);\n    setInteractionAreasContainer(player.videojs, tracksContainer);\n  }\n\n  function getInteractionAreasConfig() {\n    const { cldSrc } = currentSource;\n    return cldSrc && cldSrc.getInteractionAreas();\n  }\n\n  function removeLayoutMessage() {\n    removeInteractionAreasContainer(player.videojs);\n    setAreasPositionListener();\n    player.play();\n  }\n\n  function setLayoutMessage() {\n    if (!isInteractionAreasEnabled()) {\n      return;\n    }\n\n    if (shouldLayoutMessage()) {\n      let layoutMessageTimout = null;\n      const showItAgainCheckbox = get(videojsOptions, 'interactionDisplay.layout.showAgain', false);\n      player.pause();\n\n      createInteractionAreaLayoutMessage(player.videojs, () => {\n        clearTimeout(layoutMessageTimout);\n        removeLayoutMessage();\n      }, showItAgainCheckbox);\n\n      if (!showItAgainCheckbox) {\n        layoutMessageTimout = setTimeout(removeLayoutMessage, CLOSE_INTERACTION_AREA_LAYOUT_DELAY);\n      }\n    } else {\n      removeLayoutMessage();\n    }\n  }\n\n  function handleAds() {\n    player.on('adsready', () => {\n      player.videojs.ima.addEventListener(window.google.ima.AdEvent.Type.ALL_ADS_COMPLETED, setLayoutMessage);\n    });\n  }\n\n  function init() {\n    currentSource = currentSource || player.videojs.currentSource();\n\n    if (isInteractionAreasEnabled()) {\n\n      player.videojs.el().classList.add('interaction-areas');\n\n      player.videojs.one(PLAYER_EVENT.PLAY, () => {\n        if (typeof player.videojs.ima === 'object') {\n          handleAds();\n        } else {\n          setLayoutMessage();\n        }\n      });\n\n      const setInteractionAreasContainerSize = throttle(setContainerSize, 100);\n\n      player.videojs.on(PLAYER_EVENT.FULL_SCREEN_CHANGE, () => {\n        // waiting for fullscreen will end\n        setTimeout(setInteractionAreasContainerSize, 100);\n      });\n\n      const resizeDestroy = addEventListener(window, 'resize', setContainerSize, false);\n\n      player.videojs.on(PLAYER_EVENT.DISPOSE, resizeDestroy);\n    }\n\n    player.videojs.on(PLAYER_EVENT.ENDED, () => {\n      unZoom();\n    });\n\n    player.videojs.on(PLAYER_EVENT.ERROR, () => {\n      player.pause();\n    });\n  }\n\n  function onZoom(src, newOption, item) {\n    const originalCurrentTime = player.currentTime();\n    const isSyncOffsetTime = getIsSyncOffsetTime();\n    const { cldSrc } = currentSource;\n    const currentSrcOptions = cldSrc.getInitOptions();\n    const option = newOption || { transformation: currentSrcOptions.transformation };\n    const transformation = !src && getZoomTransformation(player.videoElement, item);\n    const sourceOptions = transformation ? videojs.obj.merge({ transformation }, option) : option;\n\n    const newSource = cldSrc.isRawUrl ? currentSource.src : { publicId: cldSrc.publicId() };\n    player.source(transformation ? { publicId: cldSrc.publicId() } : src, sourceOptions).play();\n    isSyncOffsetTime && player.currentTime(originalCurrentTime);\n\n    isZoomed = true;\n\n    setGoBackButton();\n\n    unZoom = () => {\n      if (isZoomed) {\n        isZoomed = false;\n        const currentZoomedTime = player.currentTime();\n        const duration = player.duration();\n        player.source(newSource, currentSrcOptions).play();\n        isSyncOffsetTime && currentZoomedTime < duration && player.currentTime(currentZoomedTime);\n        setAreasPositionListener();\n      }\n    };\n  }\n\n  function onInteractionAreasClick({ event, item, index }) {\n    const interactionAreasConfig = getInteractionAreasConfig();\n\n    interactionAreasConfig.onClick && interactionAreasConfig.onClick({\n      item,\n      index,\n      event,\n      zoom: (source, option) => {\n        onZoom(source, option, item);\n      }\n    });\n  }\n\n  function addInteractionAreasItems(interactionAreasData, previousInteractionAreasData, durationTime = 0) {\n    const configs = { playerOptions: playerOptions, videojsOptions: videojsOptions };\n\n    if (previousInteractionAreasData) {\n      updateInteractionAreasItem(player.videojs, configs, interactionAreasData, previousInteractionAreasData, durationTime, onInteractionAreasClick);\n    } else {\n      const interactionAreasItems = interactionAreasData.map((item, index) => {\n        return getInteractionAreaItem(configs, item, index, durationTime, (event) => {\n          onInteractionAreasClick({ event, item, index });\n        });\n      });\n\n      setInteractionAreasContainer(player.videojs, createElement('div', { 'class': INTERACTION_AREAS_CONTAINER_CLASS_NAME }, interactionAreasItems));\n    }\n  }\n\n  function setContainerSize() {\n    if (isInteractionAreasEnabled()) {\n      setInteractionAreasContainerSize(player.videojs, player.videoElement);\n    }\n  }\n\n  function addCueListener(track) {\n    if (!track) {\n      return;\n    }\n\n    let previousTracksData = null;\n\n    track.addEventListener('cuechange', () => {\n      const activeCue = track.activeCues && track.activeCues[0];\n\n      if (activeCue) {\n        const durationTime = Math.max(Math.floor((activeCue.endTime - activeCue.startTime) * 1000), DEFAULT_INTERACTION_ARE_TRANSITION);\n\n        const tracksData = JSON.parse(activeCue.text);\n\n        addInteractionAreasItems(tracksData, previousTracksData, durationTime);\n        !previousTracksData && setContainerSize();\n        previousTracksData = tracksData;\n      } else {\n        removeInteractionAreasContainer(player.videojs);\n        previousTracksData = null;\n      }\n    });\n  }\n\n  init();\n};\n","export const BUTTON_THEME = {\n  TRANSPARENT_WHITE: 'transparent-white'\n};\n","/**\n * Wraps the given function, `fn`, with a new function that only invokes `fn`\n * at most once per every `wait` milliseconds.\n *\n * @function\n * @param    {Function} fn\n *           The function to be throttled.\n *\n * @param    {number}   wait\n *           The number of milliseconds by which to throttle.\n *\n * @return   {Function}\n */\n\nfunction throttle(fn, wait) {\n  let last = window.performance.now();\n\n  const throttled = function(...args) {\n    const now = window.performance.now();\n\n    if (now - last >= wait) {\n      fn(...args);\n      last = now;\n    }\n  };\n\n  return throttled;\n}\n\nexport { throttle };\n"],"names":["themedButton","_ref","text","onClick","theme","loadingDelay","elementsCreator","tag","attr","class","children","style","getInteractionAreaItemId","item","index","id","type","getInteractionAreaItem","durationTime","playerOptions","videojsOptions","defaultColor","getDefaultPlayerColor","accentColor","colors","accent","get","INTERACTION_AREAS_THEME","PULSING","INTERACTION_AREAS_PREFIX","left","top","width","height","transitionDuration","event","name","callback","SHADOWED","borderColor","percentageToFixedValue","outOf","value","setInteractionAreasContainer","videojs","newInteractionAreasContainer","currentInteractionAreasContainer","getInteractionAreasContainer","replaceWith","el","appendChild","getInteractionAreaElementById","interactionAreasContainer","querySelector","onClickInteractionAreaLayoutClick","checked","arguments","length","undefined","noop","localStorage","setItem","INTERACTION_AREA_LAYOUT_LOCAL_STORAGE_NAME","JSON","parse","INTERACTION_AREAS_CONTAINER_CLASS_NAME","removeInteractionAreasContainer","parentNode","removeChild","interactionAreasService","player","isZoomed","currentSource","currentTrack","unZoom","getIsSyncOffsetTime","interactionAreasConfig","getInteractionAreasConfig","syncOffsetTime","isInteractionAreasEnabled","enabled","enable","setAreasPositionListener","removeRemoteTextTrack","isEnabled","Array","isArray","template","addInteractionAreasItems","setContainerSize","vttUrl","TEMPLATE_INTERACTION_AREAS_VTT","addMetadataTrack","track","previousTracksData","addEventListener","activeCue","activeCues","Math","max","floor","endTime","startTime","DEFAULT_INTERACTION_ARE_TRANSITION","tracksData","addCueListener","cldSrc","getInteractionAreas","removeLayoutMessage","play","setLayoutMessage","interactionDisplay","getItem","layoutMessageTimout","showItAgainCheckbox","pause","round","random","tracksContainer","src","INTERACTION_AREA_HAND_ICON","CLOSE_INTERACTION_AREA_LAYOUT_DELAY","target","for","filter","i","createInteractionAreaLayoutMessage","clearTimeout","setTimeout","shouldLayoutMessage","onInteractionAreasClick","zoom","source","option","newOption","originalCurrentTime","currentTime","isSyncOffsetTime","currentSrcOptions","getInitOptions","transformation","getZoomTransformation","videoElement","interactionAreaItem","videoHeight","videoWidth","itemX","itemY","itemWidth","itemHeight","videoAspectRatio","itemAspectRatio","x","y","min","crop","sourceOptions","merge","newSource","isRawUrl","publicId","button","createElement","setGoBackButton","currentZoomedTime","duration","onZoom","interactionAreasData","previousInteractionAreasData","configs","updateInteractionAreasItem","forEach","itemElement","itemId","isExistItem","some","styleElement","shouldBeRemoved","interactionAreasItems","map","setInteractionAreasContainerSize","clientHeight","clientWidth","classList","add","one","PLAYER_EVENT","PLAY","ima","on","window","google","AdEvent","Type","ALL_ADS_COMPLETED","throttle","FULL_SCREEN_CHANGE","resizeDestroy","DISPOSE","ENDED","ERROR","init","fn","wait","last","performance","now"],"sourceRoot":""}