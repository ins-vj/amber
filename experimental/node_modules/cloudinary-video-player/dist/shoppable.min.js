"use strict";(self.webpackChunkcloudinary_video_player=self.webpackChunkcloudinary_video_player||[]).push([[990],{3462:(t,e,s)=>{s.d(e,{default:()=>K});var o=s(2245),a=s.n(o);const l=(t,e)=>{let s=Element.prototype;return(s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.msMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)}).call(t,e)};var i=s(429),r=s(8071);const n={location:"right",toggleIcon:"",width:"20%",startState:"openOnPlay",autoClose:2,transformation:{quality:"auto",width:"auto",fetch_format:"auto",crop:"scale"},products:[],showPostPlayOverlay:!1},c="goto",p="seek",d="overlay",h="shoppable-panel-visible",u="shoppable-panel-hidden",m="shoppable-products-overlay",_="cld-spbl-panel",g="cld-spbl-toggle",y="cld-spbl-toggle-icon",f="cld-spbl-bar-inner",b="animate",v="cld-spbl-item",C="cld-spbl-img";var E=s(5672);const T=a().dom||a(),N=a().getComponent("Component");class P extends N{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.options_=e,this.player_=t,this.player_.on(E.Z.SHOW_PRODUCTS_OVERLAY,this.renderProducts),this.dispose=()=>{this.layout_.dispose()}}renderProducts=()=>{this.player_.removeClass(h),this.player_.addClass(u),this.player_.addClass(m),this.layout_.innerHTML="";const t=this.player_.currentTime();this.options_.products.filter((e=>e.hotspots&&e.hotspots.some((e=>(0,i.T)(e.time)===t)))).forEach((e=>{const s=(0,r.sE)(e.hotspots,(e=>(0,i.T)(e.time)===t)),o=T.createEl("div",{className:"cld-spbl-product-hotspot-name"},{},e.productName),a=T.createEl("div",{className:"cld-spbl-product-tooltip cld-spbl-product-tooltip-"+s.tooltipPosition},{},o),l=T.createEl("a",{className:"cld-spbl-product-hotspot accent-color-text",href:s.clickUrl,target:"_blank"},{style:"left:"+s.x+"; top:"+s.y+";"},a);this.layout_.appendChild(l)})),this.player_.one(E.Z.SEEKING,this.clearLayout),this.player_.one(E.Z.PLAY,this.clearLayout)};clearLayout=()=>{this.layout_.innerHTML="",this.player_.removeClass(m)};createEl(){const t=this.player_.currentDimensions();return this.layout_=T.createEl("div",{className:"cld-spbl-products-overlay",style:`padding-top: ${t.height/t.width*100}%;`}),this.layout_}}a().registerComponent("ShoppableProductsOverlay",P);const w=P,L=a().dom||a(),k=a().getComponent("ClickableComponent");class S extends k{constructor(t,e){super(t,e),this.options_=e}handleClick(t){t.preventDefault(),t.stopPropagation(),this.options_.clickHandler()}createEl(){let t={},e={};this.options_.toggleIcon?(t={className:`${y} cld-spbl-toggle-custom-icon vjs-icon-close`},e={style:`background-image: url(${this.options_.toggleIcon})`}):t={className:`${y} vjs-icon-cart`};const s=L.createEl("span",t,e),o=super.createEl("a",{className:`${g} base-color-bg`});return o.appendChild(s),this.player_.on(E.Z.PRODUCT_BAR_MIN,(()=>{setTimeout((()=>{s.classList.add(b),setTimeout((()=>{s.classList.remove(b)}),1e3)}),500)})),o}}a().registerComponent("shoppablePanelToggle",S);const I=S,A=a().dom||a(),M=a().getComponent("Component");class H extends M{constructor(t,e){super(t,e),this.player_=t,this.player().addClass("cld-shoppable-panel"),this.player().addClass(u),this.contentWrpEl_=A.createEl("div",{className:"cld-spbl-bar"}),this.contentBannerEl_=A.createEl("div",{className:"cld-spbl-banner-msg base-color-text"},{},this.options_.bannerMsg||"Shop the Video"),this.contentWrpEl_.appendChild(this.contentBannerEl_);const s=new w(this.player_,this.options_);this.contentWrpEl_.appendChild(s.el_),this.contentEl_=A.createEl("div",{className:f}),this.contentWrpEl_.appendChild(this.contentEl_),this.player().el().appendChild(this.contentWrpEl_),this.addChild(new I(this.player_,{toggleIcon:this.options_.toggleIcon,clickHandler:()=>{this.togglePanel()}})),this.addChild("ShoppablePanel",this.options_),this.dispose=()=>{this.removeLayout(),super.dispose()},this.togglePanel=t=>{!0===t?(this.player().removeClass(u),this.player().addClass(h)):!1===t?(this.player().removeClass(h),this.player().addClass(u)):(this.player().toggleClass(u),this.player().toggleClass(h));let e=this.player().hasClass(h)?"productBarMax":"productBarMin";this.player().trigger(e)},"open"===this.options_.startState&&this.togglePanel(!0),this.player_.on(E.Z.PLAY,(()=>{this.player_.currentTime()<.01&&("openOnPlay"===this.options_.startState&&this.togglePanel(!0,this.options_.autoClose),this.options_.autoClose&&-1!==this.options_.startState.indexOf("open")&&setTimeout((()=>{l(this.contentEl_,":hover")?this.contentEl_.addEventListener("mouseleave",(()=>{this.togglePanel(!1)}),{once:!0}):this.togglePanel(!1)}),1e3*this.options_.autoClose))}))}createEl(){return super.createEl("div")}}a().registerComponent("shoppableBarLayout",H);const x=H;var $=s(1137),D=s(3483),Z=s(2508);const O=a().getComponent("ClickableComponent"),B=a().dom||a(),j={width:132};class W extends O{constructor(t,e){super(t,e),this.options_=e,this.isDragged=!1}handleClick(t){t.preventDefault(),t.stopPropagation(),l(this.el_,`.dragged .${v}`)||this.options_.clickHandler(t),this.isDragged=!1}getTitle(){return this.options_.conf.title}createEl(){const t=super.createEl("a",{className:`${v} base-color-bg accent-color-text`,href:"#"});t.setAttribute("data-product-id",this.options_.conf.productId||""),t.setAttribute("data-product-name",this.options_.conf.productName||""),this.options_.conf.onHover&&z(t,this.options_.conf.onHover,this.options_.item.cloudinaryConfig()),this.options_.conf.onClick&&R(t,this.options_.conf.onClick);const e=super.createEl("img",{className:C},{src:this.options_.item.url(j)});if(t.appendChild(e),this.getTitle()){const e=B.createEl("div",{className:"cld-spbl-item-info base-color-semi-bg text-color-text"}),s=B.createEl("span",{className:"cld-spbl-item-title"},{},this.getTitle());e.appendChild(s),t.appendChild(e)}return t}}const z=(t,e,s)=>{if(t.setAttribute("data-hover-action",e.action),e.action===d){const s=B.createEl("span",{className:"cld-spbl-overlay-text base-color-text"},{},e.args),o=B.createEl("span",{className:"cld-spbl-overlay text-color-semi-bg base-color-text"},{title:e.args},s);t.appendChild(o)}else{const o=new Z.Z(e.args.publicId,{cloudinaryConfig:s,transformation:e.args.transformation}),a=B.createEl("img",{className:`${C} cld-spbl-hover-img`},{src:o.url(j)});t.appendChild(a)}},R=(t,e)=>{t.setAttribute("data-click-action",e.action),t.setAttribute("data-pause",e.pause),e.action===p?t.setAttribute("data-seek",e.args.time):e.action===c&&t.setAttribute("data-goto-url",e.args.url)};a().registerComponent("shoppablePanelItem",W);const U=W,X=a().getComponent("Component");class q extends X{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e),this.options=e;const s=()=>{this.render()};t.on(E.Z.SHOPPABLE_ITEM_CHANGED,s),this.render(),this.dispose=()=>{super.dispose(),t.off(E.Z.SHOPPABLE_ITEM_CHANGED,s)}}createEl(){const t=super.createEl();return[_,"base-color-bg"].map((e=>t.classList.add(e))),t}removeAll(){const t=this.children();for(let e=t.length-1;e>=0;--e)this.removeChild(t[e])}getItems(){const t=this.player_.cloudinary.cloudinaryConfig();return this.options.products.map((e=>{e.onHover&&"object"==typeof e.onHover.args&&(e.onHover.args.transformation=(0,$.assign)({},this.options.transformation,e.onHover.args.transformation));const s={productId:e.productId,productName:e.productName,title:e.title,onHover:e.onHover,onClick:e.onClick,startTime:e.startTime,endTime:e.endTime};return{imageSrc:new Z.Z(e.publicId,{cloudinaryConfig:t,transformation:(0,$.assign)({},this.options.transformation,e.transformation)}),conf:s}}))}scrollToActiveItem(){const t=this.el_.getElementsByClassName("active");if(t.length>0){const e=t[0].offsetTop-12;"scrollBehavior"in document.documentElement.style?this.el_.scrollTo({top:e,behavior:"smooth"}):this.el_.scrollTop=e}}render(){this.removeAll();const t=this.getItems(),e=(0,D.P)((()=>this.scrollToActiveItem()),1e3);t.forEach(((t,s)=>{const o=new U(this.player(),{item:t.imageSrc,conf:t.conf,next:1===s,current:0===s,clickHandler:t=>{let e=t.currentTarget||t.target,s=this.player_.ended()?"productClickPost":"productClick";if(this.player_.trigger(s,{productId:e.dataset.productId,productName:e.dataset.productName}),e.dataset.clickAction===c)window.open(e.dataset.gotoUrl,"_blank");else if(e.dataset.clickAction===p){const t=(0,i.T)(e.dataset.seek);null!==t&&(this.player_.addClass("vjs-has-started"),this.player_.postModal&&this.player_.postModal.close(),this.player_.currentTime(t),this.player_.removeClass(h),this.player_.addClass(u),this.player_.addClass(m),this.player_.one("seeked",(()=>this.player_.trigger("showProductsOverlay"))))}"false"!==e.dataset.pause&&(this.player_.pause(),(0,i.T)(e.dataset.pause)&&setTimeout((()=>{this.player_.play()}),1e3*(0,i.T)(e.dataset.pause)))}});o.on("mouseover",(t=>{let e=t.currentTarget||t.target,s=this.player_.ended()?"productHoverPost":"productHover";this.player_.trigger(s,{productId:e.dataset.productId,productName:e.dataset.productName})})),void 0!==t.conf.startTime&&void 0!==t.conf.endTime&&this.player_.on(E.Z.TIME_UPDATE,(()=>{const s=this.player_.currentTime();s>=t.conf.startTime&&s<t.conf.endTime?(o.el_.classList.add("active"),e()):o.el_.classList.contains("active")&&o.el_.classList.remove("active")})),this.addChild(o)}))}}a().registerComponent("shoppablePanel",q);const G=q,V=a().dom||a();const Y=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options_={...e,postPlay:!0},this.player_=t,this.render(),this.handleDragToScroll(),this.dispose=()=>{this.layout_.dispose()}}handleDragToScroll(){const t=this.player_.postModal.el_.querySelector(`.${_}`);let e=!1,s=0,o=0;t.addEventListener("mousedown",(a=>{e=!0,s=a.pageX-t.offsetLeft,o=t.scrollLeft})),document.addEventListener("mouseup",(o=>{e=!1,setTimeout((()=>{t.classList.remove("dragged")}),300);const a=o.pageX-t.offsetLeft-s;Math.abs(a)>5&&o.preventDefault()})),document.addEventListener("mousemove",(a=>{if(!e)return;a.preventDefault();const l=a.pageX-t.offsetLeft-s;t.scrollLeft=o-l,Math.abs(l)>5&&!t.classList.contains("dragged")&&t.classList.add("dragged")}))}render(){this.player_.postModal=null;const t=V.createEl("div",{className:"cld-spbl-post-play"}),e=new G(this.player_,this.options_),s=V.createEl("div",{className:"cld-spbl-post-title base-color-text"},{},this.options_.bannerMsg||"Shop the Video"),o=this.player_.cloudinary.currentPoster();o.transformation([o.transformation().toOptions?o.transformation().toOptions():{},{effect:"blur:3000"}]);const a=V.createEl("div",{className:"cld-spbl-post-play-bg",style:`background-image: url("${o.url()}")`}),l=V.createEl("button",{className:"cld-spbl-replay-btn base-color-bg vjs-icon-replay",onclick:()=>{this.player_.trigger("replay"),this.player_.postModal.close(),this.player_.play()}},{},"Replay");t.appendChild(a),t.appendChild(s),t.appendChild(e.el()),t.appendChild(l),this.player_.postModal=this.player_.createModal(t,{name:"postModal",uncloseable:!0}),this.player_.addClass("cld-spbl-post-modal"),this.player_.postModal.on("beforemodalclose",(()=>{this.player_.removeClass("cld-spbl-post-modal")}))}};const K=class{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options_=a().obj.merge(n,e),this.player_=t,this.options_.showPostPlayOverlay&&this.player_.on(E.Z.ENDED,(()=>{this.player_.addChild(new Y(this.player_,this.options_))}));const s=this.options_.width;this._injectCSS(`\n      .${f} {\n        transform: translateX(${s});\n      }\n      .${h} .vjs-control-bar {\n        width: calc(100% - ${s});\n      }\n      .${g} {\n        right: ${s};\n      }\n      .${_}{\n        width: ${s};\n      }\n    `),this._setListeners()}_setListeners(){const t=this._resizeHandler.bind(this);this.player_.on(E.Z.RESIZE,t),window.addEventListener("resize",t),this.dispose=()=>{this.player_.off(E.Z.RESIZE,t),window.removeEventListener("resize",t),this.layout_.dispose()}}_injectCSS(t){const e=document.createElement("style");e.innerHTML=t,this.player_.el_.appendChild(e)}_resizeHandler(){const t=[["sm",0,80],["md",81,110],["lg",111,170]],e=parseFloat(this.options_.width)/100*this.player_.el_.clientWidth;let s=!1;if(e){for(const[o,a,l]of t)e>a&&e<=l&&(this.layout_.contentWrpEl_.setAttribute("size",o),s=o);s||this.layout_.contentWrpEl_.removeAttribute("size")}}init(){this.render()}render(){this.layout_=new x(this.player_,this.options_)}}},3483:(t,e,s)=>{function o(t,e){let s=window.performance.now();return function(){const o=window.performance.now();o-s>=e&&(t(...arguments),s=o)}}s.d(e,{P:()=>o})},429:(t,e,s)=>{s.d(e,{K:()=>a,T:()=>l});const o=[1,4,5,6,7,10,11],a=function(t){let e=0,s=0,a=0;if(s=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(t)){for(let t,e=0;t=o[e];++e)s[t]=+s[t]||0;s[2]=(+s[2]||1)-1,s[3]=+s[3]||1,"Z"!==s[8]&&void 0!==s[9]&&(a=60*s[10]+s[11],"+"===s[9]&&(a=0-a)),e=Date.UTC(s[1],s[2],s[3],s[4],s[5]+a,s[6],s[7])}else e=NaN;return e},l=function(t){const[e,s,o]=t.split(":").reverse();let a=null;return isNaN(e)||(a=60*(+o||0)*60+60*(+s||0)+ +e),a}}}]);
//# sourceMappingURL=shoppable.min.js.map